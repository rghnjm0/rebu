{% extends "base.html" %}

{% block title %}r/{{ community.name }} - {{ community.display_name }}{% endblock %}

{% block content %}
<div class="community-detail">
    <div class="community-header">
        <div class="community-info">
            <h1>r/{{ community.name }}</h1>
            <h2>{{ community.display_name }}</h2>

            {% if community.description %}
            <p class="community-description">{{ community.description }}</p>
            {% endif %}

            <div class="community-meta">
                <span class="meta-item">
                    <strong>{{ subscribers_count }}</strong> подписчиков
                </span>
                <span class="meta-item">
                    Создатель: <a href="#">{{ community.owner_name }}</a>
                </span>
                <span class="meta-item">
                    Создано: {{ community.created_at }}
                </span>
                {% if community.is_public %}
                <span class="meta-item public">Публичное</span>
                {% else %}
                <span class="meta-item private">Приватное</span>
                {% endif %}
            </div>
        </div>

        <div class="community-actions">
            {% if session.user_id %}
                {% if is_subscribed %}
                    <a href="{{ url_for('toggle_subscription', community_name=community.name) }}"
                       class="btn btn-secondary">
                        Отписаться
                    </a>
                {% else %}
                    <a href="{{ url_for('toggle_subscription', community_name=community.name) }}"
                       class="btn btn-primary">
                        Подписаться
                    </a>
                {% endif %}

                <a href="{{ url_for('create_post') }}" class="btn btn-success">
                    Создать пост
                </a>
            {% else %}
                <a href="{{ url_for('login') }}" class="btn btn-primary">
                    Войдите, чтобы подписаться
                </a>
            {% endif %}
        </div>
    </div>

    <div class="community-posts">
        <h3>Последние посты</h3>

        {% if posts %}
            {% for post in posts %}
            <div class="post">
                <div class="vote">
                    <a href="{{ url_for('vote_post', post_id=post.id, vote_type='up') }}"
                       class="vote-btn up {% if post.id in user_votes and user_votes[post.id] == 'up' %}voted{% endif %}">
                        ↑
                    </a>
                    <span class="score">{{ post.upvotes - post.downvotes }}</span>
                    <a href="{{ url_for('vote_post', post_id=post.id, vote_type='down') }}"
                       class="vote-btn down {% if post.id in user_votes and user_votes[post.id] == 'down' %}voted{% endif %}">
                        ↓
                    </a>
                </div>
                <div class="post-content">
                    <h3><a href="{{ url_for('post_detail', post_id=post.id) }}">{{ post.title }}</a></h3>
                    <div class="post-meta">
                        <span>от {{ post.username }}</span>
                        <span>•</span>
                        <span>{{ post.created_at }}</span>
                        <span>•</span>
                        <span>{{ post.upvotes }} ↑ / {{ post.downvotes }} ↓</span>
                        <span>•</span>
                        <a href="{{ url_for('post_detail', post_id=post.id) }}">комментарии</a>
                        {% if session.user_id %}
                        <span>•</span>
                        <a href="{{ url_for('toggle_bookmark', post_id=post.id) }}" class="bookmark-link" title="Добавить в закладки">
                            {% if is_bookmarked(post.id) %}★{% else %}☆{% endif %}
                        </a>
                        {% endif %}
                    </div>
                    {% if post.post_type == 'text' %}
                        <p class="post-text">{{ post.content[:200] }}{% if post.content|length > 200 %}...{% endif %}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <p>В этом сообществе пока нет постов.</p>
                {% if session.user_id %}
                    <p>Будьте первым, кто создаст пост!</p>
                    <a href="{{ url_for('create_post') }}" class="btn btn-primary">Создать пост</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}